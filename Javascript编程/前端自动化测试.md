## 前端自动化测试
1. 针对新项目引入前端自动化测试，能够保证项目需求高质量的输出；
2. 前端自动化测试属于前端工程化重要的一部分，特别是在大型项目中；
3. 体量大的老项目【难以维护的项目】可以引入前端自动化测试，，保证在现有基础上维护功能的质量，而不是一定要考虑重构。

## 测试核心概念
1. 单元测试<br/>
![](./../images/jsTest/jt001.png)<br/>
1.1 [karma](http://karma-runner.github.io/3.0/intro/installation.html)测试环境搭建<br/>
```
// 第1步
npm init

// 第2步
npm i jasmine-core karma karma-chorme-launcher karma-jasmine karma-phantomjs-launcher --save-dev

// 第3步：编写测试案例-->在项目根目录按如下路径创建文件tests/unit/index.js, tests/unit/index.spec.js
// index.js
window.add = function (a) {
  return a + 1;
}
//index.spec.js
describe("函数的基本API测试", function() {
  it("+1函数是否可用", function () {
    expect(window.add(1)).toBe(3)
  })
})
// 第4步: 初始karma，生成一个karma.conf.js
karam init 
// 第5步: 修改karma.conf.js
{
  ...
  // list of files / patterns to load in the browser
  files: [
    './tests/unit/*.js',
    './tests/unit/*.spec.js'
  ],
  ...
  singleRun: true,
  ...
}

// 当编辑一些测试用例后，第3步：运行
方式1：./node_modules/karma/bin/karma start 
方式2：karma start
```


* 利用selenium-webdriver自动化e2e测试环境搭建<br/>

```javascript
// 第1步：
npm i selenium-webdriver -D

// 第2步：下载驱动，并把驱动复制到项目根目录下
[Chrome]-->	chromedriver(.exe)
[Internet Explorer]-->	IEDriverServer.exe
[Edge]-->	MicrosoftWebDriver.msi
[Firefox]-->	geckodriver(.exe)
[Opera]-->	operadriver(.exe)
[Safari]-->	safaridriver

// 第3步：编写测试案例-->在项目根目录按如下路径创建文件tests/e2e/index.js
const {Builder, By, Key, until} = require('selenium-webdriver');

(async function example() {
  let driver = await new Builder().forBrowser('firefox').build();
  try {
    await driver.get('https://www.baidu.com/');
    await driver.findElement(By.name('wd')).sendKeys('webdriver', Key.RETURN);
    await driver.wait(until.titleIs('webdriver_百度搜索'), 1000);
  } finally {
    await driver.quit();
  }
})();

// 第4步：package.json
{
  ...
  "scripts": {
    ...
    "e2e": "node ./tests/e2e/index.js"
  },
  ...
}

// 第5步：执行测试
npm run e2e
```
*  服务端代码测试-mocha搭建<br/>
*  其他测试框架：jest,f3etest,nightwatch,rize<br/>

2. 性能测试<br/>
3. 安全测试<br/>
4. 功能测试<br/>
5. UI还原测试<br/>

## jest（v24.8.0）

1. jest demo
```
// 初始化项目
npm init

// 安装jest
npm i jest -D

```

2. jest自定义配置
```
// 在第1点创建的项目中运行命令
npx jest --init
// 选择jsdom、yes、yes

// 项目文件夹中生成一个jest.config.js
```
3. 匹配器
* 通用匹配器 ---- toBe, toEqual, toBeNull, toBeUdefined, toBeDefined, toBeTruthy, toBeFalsy
* 取反匹配器 ---- not
* Number ---- toBeGreaterThan, toBeLessThan, toBeGreaterThanOrEqual, toBeLessThanOrEqual, toBeCloseTo
* string ---- toMatch
* Array, Set ---- toContain
* 异常 --- toThrow
* 
> !(更多匹配器)[https://jestjs.io/docs/expect]

4. 异步代码测试方法
* 回调类型异步函数的测试<br/>
![](./../images/jsTest/jt004.png)<br/>
![](./../images/jsTest/jt003.png)
*  返回promise对象<br/>
![](./../images/jsTest/jt005.png)<br/>
方式1：<br>
![](./../images/jsTest/jt006.png)<br/>
方式2：toMatchObject表示当前值包含传入的值即可<br>
![](./../images/jsTest/jt008.png)<br/>
方式3：<br>
![](./../images/jsTest/jt011.png)<br/>
* 测试404返回<br/>
方式1：expect.assertions(1) ---- 至少执行一次expect语句<br>
![](./../images/jsTest/jt007.png)<br/>
方式2：<br>
![](./../images/jsTest/jt009.png)<br/>
> 上面test的回调返回对象是promise的函数都可以改为async函数，类似如下代码：<br/>
![](./../images/jsTest/jt010.png)<br/>

5. jest中的钩子函数
* beforeAll ---- 测试用例执行之前调用一次；afterAll：测试用例执行完成之后调用一次<br/>
![](./../images/jsTest/jt012.png)<br/>
* beforeEach ---- 每个测试用例执行之前都会调用一次；afterEach：每个测试用例执行完成之后都会调用一次<br/>；
* describe --- 分组函数，将多个用例分组。<br/>
![](./../images/jsTest/jt013.png)<br/>

5. jest中的mock，其作用：
a. 捕获函数的调用和返回结果，以及this指向和调用顺序；
b. 可以自定义返回结果；
c. 改版函数内部的实现；
* jest.fn<br/>
![](./../images/jsTest/jt014.png)<br/>
![](./../images/jsTest/jt015.png)<br/>
> fun.mock<br>
![](./../images/jsTest/jt016.png)<br/>
console.log(fun.mock)结果：<br>
![](./../images/jsTest/jt017.png)<br/>
calls ---- 存储的是变量func每次被调用时参数<br/>
instances ---- <br/>
invocationCallOrder ---- 图片中5、6、7三个func执行顺序，这里表示他们是同步执行的<br/>
results ---- 5、6、7三个func执行后的返回值<br/>
* jest.fn自定义返回值
> 传入回调函数
![](./../images/jsTest/jt025.png)<br/>
> mockReturnValueOnce --- 自定义jest.fn某一次执行后的返回值；mockReturnValue --- 自定义jest.fn执行后的返回值<br/>
![](./../images/jsTest/jt018.png)<br/>
> mockImplementationOnce --- 自定义jest.mockImplementation --- 自定义jest.fn执行后的返回值<br/>
![](./../images/jsTest/jt026.png)<br/>
也可以链式调用`func.mockReturnValueOnce('Dell').mockReturnValueOnce('Lee')`<br/>
![](./../images/jsTest/jt020.png)<br/>
![](./../images/jsTest/jt019.png)<br/>
instances ---- 每次调用func执行时，this的指向<br/>
![](./../images/jsTest/jt022.png)<br/>
![](./../images/jsTest/jt023.png)<br/>
![](./../images/jsTest/jt024.png)<br/>

6. vscode中的jest插件 jest
7. snapshot 快照测试 --- 主要用于测试配置文件<br/>
![](./../images/jsTest/jt026.png)<br/>
![](./../images/jsTest/jt027.png)<br/>
按“u”建更新所有快照<br/>
按“i”建选择性更新快照<br/>





